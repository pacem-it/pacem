

<pacem-markdown value="{{ #content0.textContent }}" root class="md-tech"></pacem-markdown>

<pre pacem hidden id="content0">

> Forms are pivotal in **Pacem JS**. 
Since nobody loves implementing forms, **Pacem JS** aims to include functionalities for as may use case as possible. More features are yet to come.  
We'll skip standard static laydown of forms and fields, since you can grasp the basics by lurking into the code of the following - hopefully more interesting - examples.

## Form nesting
`&lt;pacem-form>` elements can be nested so that **validity** and **dirtyness** may propagate upwards up to the containing form.  

</pre>

<pacemjs-snippet>
    <template>

        <!-- entities -->
        <pacem-data id="entity0" model="{}"></pacem-data>
        <pacem-data id="entity1" model="{}"></pacem-data>

        <!-- master form -->
        <pacem-form class="pacem-grid pacem-pad pad-top-1" id="form0">

            <!-- sub form #1 -->
            <pacem-form class="pacem-cell cols-6 cols-xs-12" id="form1">
                <label class="pacem-margin margin-right-2">Property of entity 1:</label>
                <pacem-input-text placeholder="anything goes..." value="{{ #entity0.model.property, twoway }}" name="prop0"></pacem-input-text>
                <pacem-required-validator hide="{{ !$this.invalid }}" watch="prop0" error-message="required"></pacem-required-validator>
            </pacem-form>

            <!-- sub form #2 -->
            <pacem-form class="pacem-cell cols-6 cols-xs-12" id="form2">
                <label class="pacem-margin margin-right-2">Property of entity 2:</label>
                <pacem-input-text placeholder="anything goes..." value="{{ #entity1.model.property, twoway }}" name="prop0"></pacem-input-text>
                <pacem-required-validator hide="{{ !$this.invalid }}" watch="prop0" error-message="required"></pacem-required-validator>
            </pacem-form>

        </pacem-form>

        <!-- feedbacks -->
        <ul>
            <li>
                Master Form is both <pacem-span css-class="{{ {'text-success': #form0.valid, 'text-danger': !#form0.valid } }}" content="{{ '<i class=\'pacem-icon\'>'+ (#form0.valid ? 'check' : 'close') +'</i> '+ (#form0.valid ? 'valid' : 'invalid') }}"></pacem-span> and <b><pacem-text text="{{ #form0.dirty ? 'dirty' : 'pristine' }}"></pacem-text></b>
            </li>
            <li>
                Sub-Form 1 is both <pacem-span css-class="{{ {'text-success': #form1.valid, 'text-danger': !#form1.valid } }}" content="{{ '<i class=\'pacem-icon\'>'+ (#form1.valid ? 'check' : 'close') +'</i> '+ (#form1.valid ? 'valid' : 'invalid') }}"></pacem-span> and <b><pacem-text text="{{ #form1.dirty ? 'dirty' : 'pristine' }}"></pacem-text></b>
            </li>
            <li>
                Sub-Form 2 is both <pacem-span css-class="{{ {'text-success': #form2.valid, 'text-danger': !#form2.valid } }}" content="{{ '<i class=\'pacem-icon\'>'+ (#form2.valid ? 'check' : 'close') +'</i> '+ (#form2.valid ? 'valid' : 'invalid') }}"></pacem-span> and <b><pacem-text text="{{ #form2.dirty ? 'dirty' : 'pristine' }}"></pacem-text></b>
            </li>
            <li>
                The serialized entities: <code><pacem-text text="{{ JSON.stringify({ 'entity 1': #entity0.model, 'entity 2': #entity1.model }) }}"></pacem-text></code>
            </li>
        </ul>


    </template>
</pacemjs-snippet>

<pacem-markdown value="{{ #content1.textContent }}" root class="md-tech"></pacem-markdown>

<pre pacem hidden id="content1">

## Form (auto)generation
> Forms can be autogenerated via proper **metadata**.  

"Proper" metadata are defined below:

```ts
type DisplayMetadata = {
    name: string, description?: string, short?: string, watermark?: string, null?: string, ui?: string, format?: string,
    css?: { [name: string]: string },
    cssClass?: string[],
}

type ValidatorMetadata = { type: string, errorMessage: string, params?: any };

type PropertyMetadata = {
    prop: string,
    type: 'object' | 'array' | string,
    display?: DisplayMetadata,
    extra?: any,
    isReadOnly?: boolean,
    dataType?: string,
    isComplexType?: boolean,
    isNullable?: boolean,
    validators?: ValidatorMetadata[],
    props?: PropertyMetadata[]
};
type TypeMetadata = {

    display?: DisplayMetadata,
    props: PropertyMetadata[],
    type?: 'object' | 'array'
}
```
Metadata-generated forms are convenient in many ways:

- They provide **consistent DOM structure** (no need to figure out);
- They provide managed **validation**;
- They provide managed **dirty-checking**;
- They provide managed **ARIA attributes** creation.
- They provide **submit and reset buttons** already synchronized with form's validity and dirtyness.

Here's the _mise en place_:
</pre>

<pacemjs-snippet>
    <template>

        <pre pacem hidden id="metajson2">
{
    "display": { "cssClass": ["pacem-grid", "grid-tiny-colgap", "grid-no-rowgap", "pacem-margin", "margin-bottom-0"] },
    "props": [
      {
        "prop": "Username",
        "type": "text",
        "display": {
            "watermark": "your username here...",
            "cssClass": ["pacem-cell"]
        },
        "validators": [
          {
            "type": "required",
            "errorMessage": "field is required"
          },
          {
            "type": "regex",
            "errorMessage": "field is not well formed",
            "params": {
              "pattern": "^[a-zA-Z'_-]+$"
            }
          },
          {
            "type": "length",
            "errorMessage": "length must be between 2 and 10",
            "params": {
              "max": 10,
              "min": 2
            }
          }
        ]
      },
      {
        "prop": "Password",
        "type": "password",
        "display": { "cssClass": ["pacem-cell", "cols-6", "cols-xs-12"] },
        "validators": [
          {
            "type": "required",
            "errorMessage": "field is required"
          }
        ]
      },
      {
        "prop": "PwdRepeat",
        "type": "password",
        "display": {
            "name": "Password (confirm)",
            "cssClass": ["pacem-cell", "cols-6", "cols-xs-12"]
        },
        "validators": [
          {
            "type": "compare",
            "errorMessage": "the two password fields are not equal",
            "params": {
              "to": "Password",
              "operator": "equal"
            }
          }
        ]
      },
      {
        "prop": "Height",
        "type": "float",
        "display": {
            "name": "Height (m)",
            "cssClass": ["pacem-cell"]
        },
        "validators": [
          {
            "type": "range",
            "errorMessage": "height must be between 1.0m and 2.5m",
            "params": {
              "max": 2.5,
              "min": 1.0
            }
          }
        ]
      }
    ]
}
        </pre>

        <pacem-data id="entity2" model="{}"></pacem-data>

        <pacem-form entity="{{ #entity2.model }}" metadata="{{ JSON.parse(#metajson2.textContent) }}" autogenerate="true"></pacem-form>

    </template>
</pacemjs-snippet>

<pacem-markdown value="{{ #content2.textContent }}" root class="md-tech"></pacem-markdown>

<pre pacem hidden id="content2">
## Behavior

Form usually behaves proactively to the user: **by default** it hints the invalid fields from the beginning and - when autogenerated - binds the **submit** and **reset buttons**
to the current status of the form (validity, dirtiness, ...).  
This default behavior can be changed by changing the value of the following properties:

- `suddenValidation` (default _true_): when set to _false_, the submit button will always be shown (if an action url is provided) and it will eventually trigger the first overall validation.
- `resettable` (default _true_): when set to _false_, the reset button will always be hidden.

## Styling

Form fields appearance can be tweaked using the **css classes** embedded in the css theme:

### Minimal
When `.form-minimal` is applied to the whole form or `.field-minimal` is applied to a specific field:

- Fonts are reduced in size,
- Icons are stripped from the label,
- Validators aren't boxes anymore, instead they're simple strings.

### Outline
When `.field-outline` is applied to a specific field:

- A pseudo-outline is applied to the focused input.

### Labels
When `.form-nolabels` is applied to the whole form or `.field-nolabel` is applied to a specific field:

- The label gets hidden.

Label visibility can depend on screen size: `.form-xs-nolabels`, `.field-xs-nolabel`, ..., `.form-4k-nolabels`, `.field-4k-nolabel`.  
Label visibility can be punctually overridden by setting `.field-label` css class on a specific field (screen size dependencies also included: `.field-xs-label`, ...).

### Stretching
By default, input fields are constrained to a specific width only for large screens.  
By setting the `.field-stretch` css class on a specific field, yo can break this rule.
</pre>

<pacemjs-snippet>
    <template>

        <pre pacem hidden id="metajson3">
{
        "display": { "cssClass": ["pacem-grid", "grid-nospace", "grid-no-rowgap", "form-minimal", "form-xs-nolabels", "pacem-pad", "pad-left-1"], "name": "Sign In" },
        "props": [
            {
                "prop": "email", "dataType": "emailaddress", "type": "string",
                "display": { "cssClass": ["pacem-cell", "field-outline"], "name": "E-mail", "watermark": "name@email.com..." },
                "validators": [
                    { "type": "required", "errorMessage": "required field" }
                ]
            },
            {
                "prop": "password", "dataType": "password", "type": "string",
                "display": { "cssClass": ["pacem-cell", "field-outline"], "name": "Password", "watermark": "password..." },
                "validators": [
                    { "type": "required", "errorMessage": "required field" }
                ]
            },
            {
                "prop": "rememberMe", "type": "boolean",
                "display": { "cssClass": ["pacem-cell", "field-nolabel"], "watermark": "Remember me on this device" }
            }
        ]
    }
</pre>

        <pacem-form action="/foo" resettable="false" sudden-validation="false" on-submit="$event.preventDefault(); #toast3.show = true" metadata="{{ JSON.parse(#metajson3.textContent) }}" entity="{}" autogenerate="true"></pacem-form>

        <pacem-shell-proxy>
            <div class="pacem-toaster toaster-bottom toaster-right">
                <pacem-toast id="toast3" class="toast-primary">Form submitted!</pacem-toast>
            </div>
        </pacem-shell-proxy>
    </template>
</pacemjs-snippet>

<pacem-form id="proto" hidden></pacem-form>
<pacemjs-descriptor target="#proto"></pacemjs-descriptor>